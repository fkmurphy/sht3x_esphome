#include "shtx_legacy.h"
#include "esphome/core/log.h"
#include <Wire.h>
#include "Adafruit_SHT31.h"

namespace esphome {
namespace shtx_legacy {

static const char *TAG = "shtx_legacy";
static Adafruit_SHT31 sht31;

void SHTxLegacy::setup() {
  ESP_LOGCONFIG(TAG, "Initializing SHT31â€¦");
  Wire.begin(21, 22);
  if (!sht31.begin(0x44)) {
    ESP_LOGE(TAG, "Sensor no encontrado");
    mark_failed();
  }
}

void SHTxLegacy::update() {
  float t = sht31.readTemperature();
  float h = sht31.readHumidity();
  if (!isnan(t) && temperature_sensor_) temperature_sensor_->publish_state(t);
  if (!isnan(h) && humidity_sensor_)    humidity_sensor_->publish_state(h);
}

}  // namespace shtx_legacy
}  // namespace esphome
